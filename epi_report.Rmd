---
title: "Epidemiological simulation report"
author: "Le CNAM, Institut Pasteur, Inserm, Université Paris-Saclay"
date: "2/10/2021"
output: pdf_document
params:
  trajmwss: NA,
  ward_names: NA,
  pop_size_P: NA,
  pop_size_H: NA,
  nVisits: NA,
  LS: NA,
  matContact: NA,
  IMMstate: NA,
  EPIstate: NA,
  clustering: NA,
  disease: NA,
  gdata: NA,
  scenarios: NA
---


```{r setup, include=FALSE}
options(tinytex.verbose = TRUE)
knitr::opts_chunk$set(echo = FALSE)
```

```{r message= FALSE, warning = FALSE}
library(mwss)
library(formattable)
```

## Objective
Dynamic epidemiological modeling is a powerful tool to analyse risk of pathogen persistence and spread, following an introduction in a population, as well as predicting the impact of surveillance and control strategies. In small populations such as patients and health care workers in health care settings, heterogeneity and stochasticity play fundamental roles due to risk of super-spreading events or epidemic extinction. Epidemic models of hospital-acquired infections generally consider a unique homogeneous population and do not account for the organizational or multi-ward structure, hindering the capacity of models to capture nosocomial spread processes accurately.

We use here a network-structured model to simulate disease spreading accross wards inside a healthcare facility and test the efficacy of intervention strategies on disease control.

## Methods
### Hospital structure and population
This report presents synthetic results of 50 simulations run for an ``r params$clustering`` hospital structure including 29 wards distributed over five buildings, and connected through healthcare workers.

<!-- Plots: 1. connectivity plot for the network of wards // 2. Population size (patients, HCWs) -->
```{r message= FALSE, warning = FALSE}
   if(length(params$ward_names) > 1) {
      # FIX ME colors only for preprocessed test datasets
      plot_connectivity(
        matContact = params$matContact,
        size = as.numeric(params$pop_size_P) + as.numeric(params$pop_size_H),
        vertexcexrate = 3,
        vertexcol = c(rep("red",3),
                      rep("blue",4),
                      rep("white",5),
                      rep("yellow",8),
                      rep("orange",9)),
        verbose = FALSE
      )
   }

  df <- data.frame(Number_of_patients = params$pop_size_P,
                 Number_of_healthcare_workers = params$pop_size_H,
                 # Daily_visits = params$nVisits,
                 Length_of_stay_in_days = params$LS, 
                 row.names = params$ward_names)
  
  colnames(df) = gsub("_", " ",colnames(df))
  
 kable(df)
                  
```

### Epidemiology: pathogen (and immunity level)
We simulate the diffusion of  ``r params$disease`` in a fully susceptible population (no immunity).

<!-- in a population with **no/low/high/heterogeneous** immunity/ -->

<!-- A couple of key parameters to include: -->
<!-- 1. Baseline transmissible (R0) -->
The baseline considered R0 was ``r if(params$disease == "Covid"){ 13 }``.

<!-- 2. Severity (probability of developing (severe) symptoms) -->
The severity (probability of developing (severe) symptoms) considered is ``r params$gdata["psevPNI"]`` for individuals without any immunity (neither vaccinated nor recovered), ``r params$gdata["psevPLI"]`` for individuals with a low immunity level (considering either an old vaccine injection or recovery), and ``r params$gdata["psevPHI"]`` for individuals with a high immunity level (considering either a recent vaccine injection or recovery).

<!-- 3. Fraction of HCW and PATIENTS with low/high immunity. -->
### Intervention strategies
<!-- A quick recap of the interventions assumed.  -->
<!-- 1. confinement/contact restriction to detected patients -->

```{asis, echo = "ISO"%in% params$scenarios}
print("The risk of transmission during contacts with patients detected as infected is considered null.")
```
<!-- 2. implementation of a screening area at patient admission including contact restriction/clinical examination/test -->
```{r eval="SA"%in% params$scenarios}
print("Before admission, new patients undergo a clinical examination, during which they can be tested. Symptomatic patients are always tested, and among asymptomatic or susceptible patients: 75% of patients with no vaccination or infection history, 50% of patients with old vaccination or infection history and 25% of patients with recent vaccination or infection history will undergo a test. The model considers 2 contacts of 10min with the professional in charge of admission and no contact with other patients during the admission process.")
```
<!-- 3. screening of patients by implementation of tests on a random subset of patient population at regular intervals -->
```{asis, echo = "testPat"%in% params$scenarios}
print("For patients, random testing is implemented every week in 75% of patients with no vaccination or infection history, 50% of patients with old vaccination or infection history and 10% of patients with recent vaccination or infection history.

Note that the model considers that a tested individual will not be tested again before a minimal duration fixed as the duration of the disease (eg 10 days for covid).")
```
<!-- 4. screening of healthcare workers by implementation of tests on a random subset of healthcare worker population at regular intervals -->
```{asis, echo = "testProf"%in% params$scenarios}
print("For healthcare workers, random testing is implemented every two weeks in 75% of healthcare workers with no vaccination or infection history, 50% of healthcare workers with old vaccination or infection history and 20% of healthcare workers with recent vaccination or infection history.

The model further assumes that a healthcare worker will take sick leave with 100% probability if he develops severe symptoms, 30% probability if he develops mild symptoms but is not tested or tested negative, and 50% probability if he is tested positive.

Note that the model considers that a tested individual will not be tested again before a minimal duration fixed as the duration of the disease (eg 10 days for covid).")
```

```{asis, echo = is.null(params$scenarios)}
print("No intervention strategy was implemented. We present here the results of simulations considering a baseline scenario without any interventions.")
```

```{asis, echo = !is.null(params$scenarios)}
print("We compare the results of this intervention scenario with a baseline scenario without any interventions.")
```


## Results
<!-- All plots from the simple version app. -->
<!-- ## Limitations -->
<!-- To discuss. -->
## Appendix
<!-- Full table with parameters. -->
```{r message= FALSE, warning = FALSE}

  params$gdata
  
 # kable(df)
                  
```
## Conclusions:
…

## Modelling project:
Supported by the Département d’information médicale of the Centre hospitalier Guillaume Régnier (Rennes, France), a simulation modelling project was undertaken during 2020 pandemic to evaluate the effect of infection control protocols on SARS-CoV-2 spread in french long-term care facilities. The modelling was carried out by the french Pasteur Institute, the french Conservatoire national des arts et métiers and the french University of Versailles Saint-Quentin-en-Yvelines, in collaboration with the Department of Disease Control and Epidemiology of the National Veterinary Institute of Sweden. Epidemiological simulation are performed using R-based packages: mwss and SimInf.


Results presented in this report were generated using the open source R package ‘MWSS’ which uses the Gillespie algorithm, implemented with mwss R-package.

Note that simulations were run locally and, to deal with data confidentiality challenges, the parameters and simulations were not saved on our servers.
